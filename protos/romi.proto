#VRML_SIM R2023b utf8
# license: Apache License 2.0
# A Pololu Romi robot with an integrated arm.

PROTO romi [
  field SFString   name             "Romi"
  field SFVec3f    translation      0 0 0.02
  field SFRotation rotation         0 1 0 0
  field SFString   controller       "void"
  field SFFloat    motorDamping     0.012
  field SFFloat    robotMass        0.5
  field MFNode     additionalSensors []
]
{
  Robot {
    translation IS translation
    rotation IS rotation
    children [
      Transform {
        translation 0 0 0
        children IS additionalSensors
      }
      DEF rom_chassis_shape Shape {
        appearance PBRAppearance {
          baseColor 0.3 0.3 0.3
          roughness 1
          metalness 0.5
        }
        geometry Mesh {
          url ["meshes/romi/romi-chassis-assem.stl"]
        }
        castShadows FALSE
      }
      DEF arm_base Solid {
        translation 0 0 0.039
        rotation 0 0 1 -3.1415926
        children [
          Shape {
            appearance DEF plastic PBRAppearance {
              baseColor 0.2 0.2 0.2
              roughness 0.8
            }
            geometry Mesh {
              url ["meshes/romi/romiarm_base_assem.stl"]
            }
          }
          DEF mainlink_pivot HingeJoint {
            jointParameters HingeJointParameters {
              axis 0 1 0
              anchor 0.02775 0 0.0455
            }
            endPoint DEF main_arm Solid {
              translation 0.0278 0.006 0.0455
              rotation 0 0 1 3.14
              children [
                Shape {
                  appearance USE plastic
                  geometry Mesh {
                    url ["meshes/romi/romiarm_mainlink.stl"]
                  }
                }
                DEF main_triangle HingeJoint {
                  jointParameters HingeJointParameters {
                    position -0.1
                    axis 0 1 0
                    anchor 0.073 0 0.0025
                  }
                  endPoint DEF triangle_link Solid {
                    translation 0.073 0.0125 0.0025
                    rotation 0 -1 0 0.1
                    name "triangle"
                    children [
                      DEF triangle_link_shape Shape {
                        appearance USE plastic
                        geometry Mesh {
                          url ["meshes/romi/romiarm_trianglelink.stl"]
                        }
                      }
                      Transform {
                        translation 0 -0.0175 0
                        children [ USE triangle_link_shape ]
                      }
                    ]
                    boundingObject Box {
                      size 0.01 0.001 0.01
                    }
                    physics Physics {
                    }
                  }
                }
                DEF gripper_base_jt HingeJoint {
                  jointParameters HingeJointParameters {
                    position -0.36
                    axis 0 1 0
                    anchor 0.1515 0 -0.027
                  }
                  endPoint DEF gripper_base Solid {
                    translation 0.1506 -0.0045 -0.0246
                    rotation 0 -1 0 0.36
                    name "gripper_base"
                    children [
                      DistanceSensor {
                        translation 0 0.01 -0.03
                        name "proxFront"
                        lookupTable [
                          0.0254 991 0.005,
                          0.0508 987 0.005,
                          0.0762 980 0.005,
                          0.1016 853 0.005,
                          0.127 712 0.005,
                          0.1524 585 0.005,
                          0.1778 502 0.005,
                          0.2032 435 0.005,
                          0.2286 383 0.005,
                          0.254 346 0.005,
                          0.2794 316 0.005,
                          0.3048 296 0.005,
                          0.3302 281 0.005,
                          0.3556 268 0.005,
                          0.381 255 0.005,
                          0.4064 248 0.005,
                          0.4318 239 0.005,
                          0.4572 233 0.005,
                          0.4826 229 0.005,
                          0.508 223 0.005,
                          0.5334 219 0.005,
                          0.5588 215 0.005,
                          0.5842 211 0.005,
                          0.6096 209 0.005,
                          0.635 207 0.005,
                          0.6604 205 0.005,
                          0.6858 203 0.005,
                          0.7112 201 0.005,
                          0.7366 200 0.005
                        ]
                        type "generic"
                        numberOfRays 4
                        aperture 0.02
                      }
                      Shape {
                        appearance USE plastic
                        geometry Mesh {
                          url ["meshes/romi/romiarm_gripper_base.stl"]
                        }
                      }
                      DEF slider_1 SliderJoint {
                        jointParameters JointParameters {
                          axis 0 1 0
                        }
                        device [
                          LinearMotor {
                            name "s2::right"
                            maxForce 1000
                          }
                          PositionSensor {
                            name "s2fb"
                          }
                        ]
                        endPoint DEF gripper_jaw_solid Solid {
                          translation 0 -0.006 0
                          name "gripper_jaw_1"
                          children [
                            DEF gripper_jaw_shape Shape {
                              appearance USE plastic
                              geometry Mesh {
                                url ["meshes/romi/romiarm_gripper_jaw.stl"]
                              }
                            }
                          ]
                          boundingObject DEF gripper_jaw_xform Transform {
                            translation 0.04 -0.0025 -0.015
                            rotation 1 0 1 0.15
                            children [
                              Box {
                                size 0.0253 0.005 0.023
                              }
                            ]
                          }
                        }
                      }
                      DEF slider_2 SliderJoint {
                        jointParameters JointParameters {
                          axis 0 -1 0
                        }
                        device [
                          LinearMotor {
                            name "s2::left"
                            maxForce 1000
                          }
                        ]
                        endPoint Solid {
                          translation 0 0.026 -0.03
                          rotation 1 0 0 3.14
                          children [
                            USE gripper_jaw_shape
                          ]
                          boundingObject Transform {
                            translation 0.04 -0.0025 -0.015
                            rotation 1 0 -1 -0.15
                            children [
                              Box {
                                size 0.0253 0.005 0.023
                              }
                            ]
                          }
                          physics Physics {
                          }
                        }
                      }
                      DEF tiltlink_joint HingeJoint {
                        jointParameters HingeJointParameters {
                          position -2.35
                          axis 0 1 0
                          anchor 0.009 0 0.0055
                        }
                        endPoint DEF gripper_tilt_link Solid {
                          translation 0.009 0.0035 0.0055
                          rotation 0 -1 0 2.392
                          name "tilt_link"
                          children [
                            Shape {
                              appearance USE plastic
                              geometry Mesh {
                                url ["meshes/romi/romiarm_longlink.stl"]
                              }
                            }
                            HingeJoint {
                              jointParameters HingeJointParameters {
                                axis 0 1 0
                                anchor 0.0835 0 0
                              }
                              endPoint SolidReference {
                                solidName "triangle"
                              }
                            }
                          ]
                          boundingObject Transform {
                            translation 0.046 0.00625 0
                            children [
                              Box {
                                size 0.08 0.009 0.009
                              }
                            ]
                          }
                          physics Physics {
                          }
                        }
                      }
                    ]
                    boundingObject Transform {
                      translation 0.0175 0.01 -0.015
                      children [
                        Box {
                          size 0.005 0.045 0.025
                        }
                      ]
                    }
                    physics Physics {
                    }
                  }
                }
              ]
              name "main_arm"
              boundingObject Group {
                children [
                  Transform {
                    translation 0.04 0.006 0.002
                    rotation 0 1 0 -0.05
                    children [
                      Box {
                        size 0.07 0.005 0.005
                      }
                    ]
                  }
                  Transform {
                    translation 0.115 0.006 -0.0135
                    rotation 0 1 0 0.35
                    children [
                      Box {
                        size 0.07 0.005 0.005
                      }
                    ]
                  }
                ]
              }
              physics Physics {
              }
            }
          }
          DEF mainarm_servo HingeJoint {
            jointParameters HingeJointParameters {
              position 1.2
              axis 0 1 0
              anchor 0.047 0.02 0.015
            }
            device [
              RotationalMotor {
                name "s3"
              }
              PositionSensor {
                name "s3fb"
              }
            ]
            endPoint DEF short_servo_arm Solid {
              translation 0.047 0.02 0.015
              rotation -0.4916 0.4920 -0.7185 1.8947
              name "horn_short"
              children [
                Shape {
                  appearance USE plastic
                  geometry Mesh {
                    url ["meshes/romi/romiarm_servohorn_short.stl"]
                  }
                }
                HingeJoint {
                  jointParameters HingeJointParameters {
                    position 1.5
                    anchor 0 0 0.015
                  }
                  endPoint DEF small_link Solid {
                    translation 0.0125 0 0.015
                    rotation 0.5635 -0.5631 0.6044 2.0535
                    name "small_link"
                    children [
                      HingeJoint {
                        jointParameters HingeJointParameters {
                          axis 0 1 0
                          anchor 0 0 0.025
                        }
                        endPoint SolidReference {
                          solidName "main_arm"
                        }
                      }
                      Shape {
                        appearance USE plastic
                        geometry Mesh {
                          url ["meshes/romi/romiarm_small_link.stl"]
                        }
                      }
                    ]
                    boundingObject Transform {
                      translation 0 0 0.01
                      children [
                        Box {
                          size 0.005 0.001 0.025
                        }
                      ]
                    }
                    physics Physics {
                    }
                  }
                }
              ]
              boundingObject Transform {
                rotation 0 1 0 1.57
                children [
                  Cylinder {
                    height 0.01
                    radius 0.01
                  }
                ]
              }
              physics Physics {
              }
            }
          }
          DEF tilt_servo HingeJoint {
            jointParameters HingeJointParameters {
              position 0.53
              axis 0 1 0
              anchor 0.047 -0.02 0.015
            }
            device [
              RotationalMotor {
                name "s1"
              }
              PositionSensor {
                name "s1fb"
              }
            ]
            endPoint Solid {
              translation 0.047 -0.02 0.015
              rotation 0.2534 0.2536 0.9336 1.6387
              name "long_horn"
              children [
                Shape {
                  appearance USE plastic
                  geometry Mesh {
                    url ["meshes/romi/romiarm_servohorn_long.stl"]
                  }
                }
                DEF bentlink_joint HingeJoint {
                  jointParameters HingeJointParameters {
                    position 0.25
                    anchor 0 0 0.027
                  }
                  endPoint DEF bentlink Solid {
                    translation 0.009 0 0.027
                    rotation 0 -0.9922 -0.1247 3.1416
                    name "bentlink"
                    children [
                      Shape {
                        appearance USE plastic
                        geometry Mesh {
                          url ["meshes/romi/romiarm_bentlink.stl"]
                        }
                      }
                      DEF bent_to_triangle HingeJoint {
                        jointParameters HingeJointParameters {
                          anchor 0 0.0925 0.0545
                        }
                        endPoint SolidReference {
                          solidName "triangle"
                        }
                      }
                    ]
                    boundingObject Group {
                      children [
                        Transform {
                          translation 0 0.02 0
                          children [
                            Box {
                              size 0.001 0.03 0.01
                            }
                          ]
                        }
                      ]
                    }
                    physics Physics {
                    }
                  }
                }
              ]
              boundingObject Transform {
                rotation 0 1 0 1.57
                children [
                  Cylinder {
                    height 0.005
                    radius 0.01
                  }
                ]
              }
              physics Physics {
              }
            }
          }
        ]
        name "arm_base"
        boundingObject Cylinder {
          height 0.005
          radius 0.082
        }
        physics Physics {
        }
      }
      DEF wheel_1 HingeJoint {
        jointParameters DEF wheeljoint HingeJointParameters {
          axis 0 1 0
          anchor 0 0.083 0.0077
          dampingConstant IS motorDamping
        }
        device [
          PositionSensor {
            name "encoder_left"
            resolution 0.00436
          }
          RotationalMotor {
            name "motor_left"
            consumptionFactor -0.001
            controlPID 1 0 0
            maxVelocity 15.708
            maxTorque 0.18
            multiplier -1
          }
        ]
        endPoint DEF wheel_solid Solid {
          translation 0 0.075 0.0077
          name "wheel"
          children [
            DEF wheel_shape Shape {
              appearance PBRAppearance {
                baseColor 0.6 0.6 0.6
                roughness 1
                metalness 0.5
              }
              geometry DEF wheel_mesh Mesh {
                url ["meshes/romi/romi-wheel.stl"]
              }
              castShadows FALSE
            }
          ]
          boundingObject DEF wheel_bound Transform {
            translation 0 -0.002 0
            rotation 1 0 0 1.5708
            children [
              DEF wheel_cyl Cylinder {
                height 0.008
                radius 0.035
              }
            ]
          }
          physics Physics {
          }
        }
      }
      DEF wheel_2 HingeJoint {
        jointParameters HingeJointParameters {
          axis 0 -1 0
          anchor 0 -0.083 0.0077
          dampingConstant IS motorDamping
        }
        device [
          RotationalMotor {
            name "motor_right"
            consumptionFactor -0.001
            controlPID 1 0 0
            maxVelocity 15.7
            maxTorque 0.18
          }
          PositionSensor {
            name "encoder_right"
          }
        ]
        endPoint Solid {
          translation 0.0000185 -0.075 0.0078
          rotation -0.0047 0 -1 3.1417
          name "wheel_right_solid"
          children [
            USE wheel_shape
          ]
          boundingObject Transform {
            translation 0 -0.002 0
            rotation 1 0 0 1.5708
            children [
              USE wheel_cyl
            ]
          }
          physics Physics {
          }
        }
      }
    ]
    name IS name
    model "Romi"
    boundingObject Group {
      children [
        Transform {
          translation -0.063 0 -0.015
          children [
            Sphere {
              radius 0.012
              subdivision 3
            }
          ]
        }
        Cylinder {
          height 0.02
          radius 0.083
        }
        Transform {
          translation 0.045 0 -0.015
          children [
            Sphere {
              radius 0.012
              subdivision 3
            }
          ]
        }
      ]
    }
    physics Physics {
      density -1
      mass IS robotMass
    }
    controller IS controller
    battery [ 0 ]
  }
}
